<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">

	<title>2017 CrossFit Regionals - PIP by Team Ham Planet</title>
	<meta name="description" content="Watch the 2017 CrossFit Games South and East Regionals simultaneously with picture-in-picture capabilities">
	<meta name="viewport" content="width=device-width">

	<link rel="icon" href="assets/favicon.png">

	<meta property="og:url" content="http://2017regionals.teamhamplanet.com" />
	<meta property="og:type" content="website" />
	<meta property="og:title" content="2017 CrossFit Regionals - PIP by Team Ham Planet" />
	<meta property="og:description" content="Watch the 2017 CrossFit Games South and East Regionals simultaneously with picture-in-picture capabilities" />
	<meta property="og:image" content="http://2017regionals.teamhamplanet.com/assets/logo.png" />
	<meta property="fb:app_id" content="330114430725306" />

	<style type="text/css">

		body{
			background: #101010;
			font-family: sans-serif;
			font-size: 16px;
		}

		body:after {
			content:  url('assets/logo.png');
			left: 50%;
			margin-left: -150px;
			opacity: 0.1;
			position: absolute;
			top: 200px;
		}

		#nav {
			left: 0;
			position: fixed;
			right: 0;
			text-align: center;
			top: 0;
			z-index: 2;
		}

		#nav:hover {
			background: rgba( 1, 1, 1, 0.8 );
		}

		#nav > a {
			color: #fefefe;
			display: inline-block;
			padding: 20px;
			text-decoration: none;
		}

		#nav .social {
			display: none;
			position: absolute;
			right: 20px;
			top: 20px;
		}

		#nav:hover .social {
			display: block;
		}

		#nav > a:hover,
		#nav > a.active {
			text-decoration: underline;
		}


		#frames {
			position: relative;
			z-index: 1;
		}

		#frames.split {
			margin-top: 65px;
		}

		iframe {
			width: 100%;
		}

		.frame {
			float: left;
			width: 50%;
		}

		.frame.focused {
			float: none;
			left: 0;
			position: fixed;
			right: 0;
			top: 0;
			width: 100%;
			z-index: 1;
		}

		.frame.pip {
			border: 2px solid #fefefe;
			float: none;
			position: fixed;
			right: 25px;
			top: 25px;
			width: 28%;
			z-index: 2;
		}

		.frame .handle {
			display: none;
			position: relative;
		}

		.frame .handle span {
			display: block;
			height: 100%;
			line-height: .3;
			padding-left: 4px;
			width: 10px;
		}

		.frame.pip:hover .handle {
			background: #cecece;
			display: block;
			height: 20px;
			cursor: move;
		}

		.cf:before,
		.cf:after {
			content: " ";
			display: table;
		}

		.cf:after {
			clear: both;
		}

		#ads {
			bottom: 10px;
			left: 10px;
			position: absolute;
			right: 10px;
			text-align: center;
		}

		#alert {
			background: rgba( 254, 254, 254, 0.8 );
			bottom: 0;
			color: #b50000;
			font-size: 18px;
			left: 0px;
			padding: 20px;
			position: fixed;
			right: 0px;
			text-align: center;
			z-index: 3;
		}

		#alert .remove {
			float: right;
		}

		.remove {
			color: #bf0000;
			line-height: 18px;
			font-size: 24px;
			text-decoration: none;
		}

		.loader,
		.loader:before,
		.loader:after {
			border-radius: 50%;
		}
		.loader {
			color: #fefefe;
			font-size: 11px;
			text-indent: -99999em;
			margin: 55px auto;
			position: relative;
			width: 10em;
			height: 10em;
			box-shadow: inset 0 0 0 1em;
			-webkit-transform: translateZ(0);
			-ms-transform: translateZ(0);
			transform: translateZ(0);
		}
		.loader:before,
		.loader:after {
			position: absolute;
			content: '';
		}
		.loader:before {
			width: 5.2em;
			height: 10.2em;
			background: #101010;
			border-radius: 10.2em 0 0 10.2em;
			top: -0.1em;
			left: -0.1em;
			-webkit-transform-origin: 5.2em 5.1em;
			transform-origin: 5.2em 5.1em;
			-webkit-animation: load2 2s infinite ease 1.5s;
			animation: load2 2s infinite ease 1.5s;
		}
		.loader:after {
			width: 5.2em;
			height: 10.2em;
			background: #101010;
			border-radius: 0 10.2em 10.2em 0;
			top: -0.1em;
			left: 5.1em;
			-webkit-transform-origin: 0px 5.1em;
			transform-origin: 0px 5.1em;
			-webkit-animation: load2 2s infinite ease;
			animation: load2 2s infinite ease;
		}
		@-webkit-keyframes load2 {
			0% {
				-webkit-transform: rotate(0deg);
				transform: rotate(0deg);
			}
			100% {
				-webkit-transform: rotate(360deg);
				transform: rotate(360deg);
			}
		}
		@keyframes load2 {
			0% {
				-webkit-transform: rotate(0deg);
				transform: rotate(0deg);
			}
			100% {
				-webkit-transform: rotate(360deg);
				transform: rotate(360deg);
			}
		}

	</style>

	<!-- GA -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
		ga('create', 'UA-99101531-1', 'auto');
		ga('send', 'pageview');
	</script>

</head>
<body>

	<script>
		window.fbAsyncInit = function() {
			FB.init({
				appId      : '330114430725306',
				xfbml      : true,
				version    : 'v2.9'
			});
			FB.AppEvents.logPageView();
		};

		(function(d, s, id){
			 var js, fjs = d.getElementsByTagName(s)[0];
			 if (d.getElementById(id)) {return;}
			 js = d.createElement(s); js.id = id;
			 js.src = "http://connect.facebook.net/en_US/sdk.js";
			 fjs.parentNode.insertBefore(js, fjs);
		 }(document, 'script', 'facebook-jssdk'));
	</script>

	<nav id="nav">
		<a class="ctrl" data-id="east" href="#">EAST</a>
		<a class="ctrl" data-id="south" href="#">SOUTH</a>
		<a class="ctrl active" id="split" href="#">SPLIT</a>
		<div class="social">
			<div class="fb-like" data-layout="button" data-action="like" data-colorscheme="dark" data-size="small" data-show-faces="false" data-share="true"></div>
		</div>
	</nav>

	<section class="cf split" id="frames">

		<div class="frame" id="east">
			<div class="loader"></div>
			<div class="handle"><span>.. .. ..</span></div>
		</div>

		<div class="frame" id="south">
			<div class="loader"></div>
			<div class="handle"><span>.. .. ..</span></div>
		</div>

	</section>

	<section id="ads">
		<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
		<!-- THP - 2017 Regionals -->
		<ins class="adsbygoogle" style="display:inline-block;width:728px;height:90px" data-ad-client="ca-pub-6121362130042378" data-ad-slot="4849463245"></ins>
		<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
		</script>
	</section>

	<!-- <a href="https://github.com/thomasplevy/usaw-nationals-2017-pip-video"><img style="position: absolute; top: 0; right: 0; border: 0;z-index: 3" src="https://camo.githubusercontent.com/52760788cde945287fbb584134c4cbc2bc36f904/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f77686974655f6666666666662e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png"></a> -->

	<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js" integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/fitvids/1.2.0/jquery.fitvids.min.js"></script>
	<script>( function(){

		function resizeVids() {
			$( 'body' ).fitVids( {
				customSelector: "iframe[src*='//player.ooyala.com/']"
			} );
		}

		function makeDraggable() {
			$( '.frame.pip' ).draggable( {
				handle: '.handle',
				start: function() {
					$( '.frame iframe' ).css( 'pointer-events', 'none' );
				},
				stop: function() {
					$( '.frame iframe' ).css( 'pointer-events', 'auto' );
				}
			} );
		}

		resizeVids();

		$( '#nav a.ctrl' ).on( 'click', function( e ) {

			e.preventDefault();
			var $btn = $( this ),
				id = $btn.attr( 'data-id' ),
				$frame = $( '#' + $btn.attr( 'data-id' ) );

			$btn.addClass( 'active' ).siblings().removeClass( 'active' );

			if ( ! id ) {
				return;
			}

			var curr_pip_pos = $( '.frame.pip' ).attr( 'style' );

			$( '#frames' ).removeClass( 'split' );
			$( '.frame' ).removeClass( 'focused' ).addClass( 'pip' );
			if ( curr_pip_pos ) {
				$( '.frame' ).attr( 'style', curr_pip_pos );
			}
			$frame.removeClass( 'pip' ).addClass( 'focused' ).removeAttr( 'style' );

			resizeVids();
			makeDraggable();

		} );

		$( 'a#split' ).on( 'click', function( e ) {

			e.preventDefault();
			$( '#frames' ).addClass( 'split' );
			$( '.frame' ).removeClass( 'focused pip' );

		} );

		var key = 'AIzaSyB53lwe2PqEHZX9do9umNwXZ9EC3wgn0g8',
			endpoint = 'https://www.googleapis.com/youtube/v3/';

		window.pipframes = {
			east: '',
			south: '',
		};

		function addNotice( msg ) {
			var $alert = $( '#alert' ),
				$remover = $( '<a class="remove" href="#">&times;</a>' );

			if ( ! $alert.length ) {
				$alert = $( '<div id="alert" /> ' );
				$( 'body' ).append( $alert );
			}

			$alert.html( msg );
			$alert.append( $remover );
			$remover.on( 'click', function( e ) {
				e.preventDefault();
				$( '#alert' ).remove();
			} );

		}

		function getLiveVids( warn ) {
			console.log( 'finding current streams' );
			$.get( endpoint + 'search?part=snippet&type=video&channelId=UCtcQ6TPwXAYgZ1Mcl3M1vng&eventType=live&key=' + key, function( r ) {
				if ( r.items && r.items.length ) {
					console.log( 'found streams' );
					$.each( r.items, function( i, vid ) {
						var title = vid.snippet.title.toLowerCase();
						$.each( window.pipframes, function( frame_id ) {
							if ( 0 === title.indexOf( frame_id ) ) {

								if ( window.pipframes[ frame_id ] !== vid.id.videoId ) {
									window.pipframes[ frame_id ] = vid.id.videoId;
									loadVideoFrame( frame_id, warn );
								}

							}
						} );
					} );
				} else {
					$( '.loader' ).remove();
					addNotice( 'No streams found. Try back when the streams are live (Sat 5/20 at 5:50am PST).' );
				}
				resizeVids();
				console.log( window.pipframes );
			} );
		}

		function loadVideoFrame( frame_id, warn ) {
			if ( warn ) {
				addNotice( 'A new stream is available. Reload your page to get the new stream!' );
			} else {
				var $frame = $( '#' + frame_id );
				$frame.find( '.loader' ).remove();
				$frame.prepend( '<iframe width="560" height="315" src="https://www.youtube.com/embed/' + window.pipframes[ frame_id ] + '" frameborder="0" allowfullscreen></iframe>' );
			}
		}

		getLiveVids( false );
		window.setInterval( function () {
			getLiveVids( true );
		}, 60000 * 5 );

	} )();</script>
</body>
</html>